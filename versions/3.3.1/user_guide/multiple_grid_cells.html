
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Multiple Grid Cells &#8212; MICM v3.3.1 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=bbe95013" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=6174fa28"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/multiple_grid_cells';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.15.2';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://ncar.github.io/micm/_static/switcher.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = 'v3.3.1';
        DOCUMENTATION_OPTIONS.show_version_warning_banner = false;
        </script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Solver configurations" href="solver_configurations.html" />
    <link rel="prev" title="User-Defined Rate Constants" href="user_defined_rate_constant_tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">MICM v3.3.1 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        MICM API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../citing_and_bibliography/index.html">
                        Citations and Bibliography
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-2"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-2"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-2"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-2">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NCAR/micm" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../getting_started.html">
                        Getting Started
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api/index.html">
                        MICM API
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../contributing/index.html">
                        Contributing
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../citing_and_bibliography/index.html">
                        Citations and Bibliography
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <div class="version-switcher__container dropdown">
    <button id="pst-version-switcher-button-3"
      type="button"
      class="version-switcher__button btn btn-sm navbar-btn dropdown-toggle"
      data-bs-toggle="dropdown"
      aria-haspopup="listbox"
      aria-controls="pst-version-switcher-list-3"
      aria-label="Version switcher list"
    >
      Choose version  <!-- this text may get changed later by javascript -->
      <span class="caret"></span>
    </button>
    <div id="pst-version-switcher-list-3"
      class="version-switcher__menu dropdown-menu list-group-flush py-0"
      role="listbox" aria-labelledby="pst-version-switcher-button-3">
      <!-- dropdown will be populated by javascript on page load -->
    </div>
  </div>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/NCAR/micm" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation_and_usage.html">Installation and usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="rate_constant_tutorial.html">Rate Constants (except user defined ones)</a></li>
<li class="toctree-l1"><a class="reference internal" href="user_defined_rate_constant_tutorial.html">User-Defined Rate Constants</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Multiple Grid Cells</a></li>
<li class="toctree-l1"><a class="reference internal" href="solver_configurations.html">Solver configurations</a></li>
<li class="toctree-l1"><a class="reference internal" href="but_how_fast_is_it.html">But how fast is it?</a></li>
<li class="toctree-l1"><a class="reference internal" href="openmp.html">OpenMP</a></li>
<li class="toctree-l1"><a class="reference internal" href="jit.html">A JIT-compiled solver</a></li>
<li class="toctree-l1"><a class="reference internal" href="vectorized_matrix_solver.html">Vectorized matrix solver</a></li>
</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">Multiple Grid Cells</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="multiple-grid-cells">
<span id="id1"></span><h1>Multiple Grid Cells<a class="headerlink" href="#multiple-grid-cells" title="Link to this heading">#</a></h1>
<p>This tutorial will focus on running multiple grid cells. Because the
<a class="reference internal" href="rate_constant_tutorial.html#rate-constants"><span class="std std-ref">Rate Constants (except user defined ones)</span></a> and <a class="reference internal" href="user_defined_rate_constant_tutorial.html#user-defined-rate-constants"><span class="std std-ref">User-Defined Rate Constants</span></a> showed both configuring
the mechanism by hand and building with a configuration file, we will only show building
up the mechanism by hand for this tutorial. We will use a simple 3-reaction 3-species mechanism.</p>
<div class="math notranslate nohighlight">
\[\begin{split}A &amp;\longrightarrow B, &amp;k_{1, \mathrm{user\ defined}} \\
2B &amp;\longrightarrow B + C, &amp;k_{2, \mathrm{user\ defined}} \\
B + C &amp;\longrightarrow A + C, \qquad &amp;k_{3, \mathrm{user\ defined}} \\\end{split}\]</div>
<p>We will use three grid cells. The second grid cells will have concentrations twice as large as the first grid cell.
The third grid cell will have concentrations half as large as the first grid cell.</p>
<p>If you’re looking for a copy and paste, choose
the appropriate tab below and be on your way! Otherwise, stick around for a line by line explanation.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
</input><label class="sd-tab-label" for="sd-tab-item-0">
Build the Mechanism with the API</label><div class="sd-tab-content docutils">
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iomanip&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;micm/process/user_defined_rate_constant.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;micm/solver/rosenbrock.hpp&gt;</span>

<span class="c1">// Use our namespace so that this example is easier to read</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">micm</span><span class="p">;</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Phase</span><span class="w"> </span><span class="n">gas_phase</span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="o">&gt;</span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="n">reactants</span><span class="p">({</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">products</span><span class="p">({</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">rate_constant</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">UserDefinedRateConstant</span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="n">label_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r1&quot;</span><span class="w"> </span><span class="p">}))</span>
<span class="w">                         </span><span class="p">.</span><span class="n">phase</span><span class="p">(</span><span class="n">gas_phase</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="n">reactants</span><span class="p">({</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">products</span><span class="p">({</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">rate_constant</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">UserDefinedRateConstant</span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="n">label_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r2&quot;</span><span class="w"> </span><span class="p">}))</span>
<span class="w">                         </span><span class="p">.</span><span class="n">phase</span><span class="p">(</span><span class="n">gas_phase</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="n">reactants</span><span class="p">({</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">products</span><span class="p">({</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">rate_constant</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">UserDefinedRateConstant</span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="n">label_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r3&quot;</span><span class="w"> </span><span class="p">}))</span>
<span class="w">                         </span><span class="p">.</span><span class="n">phase</span><span class="p">(</span><span class="n">gas_phase</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">RosenbrockSolver</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">solver</span><span class="p">{</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">System</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">SystemParameters</span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">gas_phase_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gas_phase</span><span class="w"> </span><span class="p">}),</span>
<span class="w">                                   </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">&gt;</span><span class="p">{</span><span class="w"> </span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">,</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                   </span><span class="n">micm</span><span class="o">::</span><span class="n">RosenbrockSolverParameters</span><span class="o">::</span><span class="n">three_stage_rosenbrock_parameters</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>

<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// mol m-3</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetConcentration</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetConcentration</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetConcentration</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>

<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.04</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3e7</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">k3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e4</span><span class="p">;</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetCustomRateParameter</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">k1</span><span class="p">));</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetCustomRateParameter</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="p">));</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetCustomRateParameter</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">k3</span><span class="p">));</span>

<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">272.5</span><span class="p">;</span><span class="w">  </span><span class="c1">// [K]</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">101253.3</span><span class="p">;</span><span class="w">  </span><span class="c1">// [Pa]</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">air_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span><span class="w">    </span><span class="c1">// [mol m-3]</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">parameters_</span><span class="p">.</span><span class="n">number_of_grid_cells_</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">cell</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">conditions_</span><span class="p">[</span><span class="n">cell</span><span class="p">].</span><span class="n">temperature_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">conditions_</span><span class="p">[</span><span class="n">cell</span><span class="p">].</span><span class="n">pressure_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pressure</span><span class="p">;</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">conditions_</span><span class="p">[</span><span class="n">cell</span><span class="p">].</span><span class="n">air_density_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">air_density</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>

<span class="w">  </span><span class="c1">// choose a timestep and print the initial state</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">time_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">  </span><span class="c1">// s</span>

<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">PrintHeader</span><span class="p">();</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">PrintState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// solve for ten iterations</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Depending on how stiff the system is</span>
<span class="w">    </span><span class="c1">// the solver integration step may not be able to solve for the full time step</span>
<span class="w">    </span><span class="c1">// so we need to track how much time the solver was able to integrate for and continue</span>
<span class="w">    </span><span class="c1">// solving until we finish</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">elapsed_solve_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">elapsed_solve_time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">time_step</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">time_step</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">elapsed_solve_time</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span>
<span class="w">      </span><span class="n">elapsed_solve_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">final_time_</span><span class="p">;</span>
<span class="w">      </span><span class="n">state</span><span class="p">.</span><span class="n">variables_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">result_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">PrintState</span><span class="p">(</span><span class="n">time_step</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="line-by-line-explanation">
<h2>Line-by-line explanation<a class="headerlink" href="#line-by-line-explanation" title="Link to this heading">#</a></h2>
<p>This mechanism only needs the user defined rate constant and the rosenbrock solver.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iomanip&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;micm/process/user_defined_rate_constant.hpp&gt;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;micm/solver/rosenbrock.hpp&gt;</span>
</pre></div>
</div>
<p>After that, we’ll use the <code class="docutils literal notranslate"><span class="pre">micm</span></code> namespace.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Use our namespace so that this example is easier to read</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">micm</span><span class="p">;</span>
</pre></div>
</div>
<p>To create a <a class="reference internal" href="../api/index.html#_CPPv4II0E0I0E000EN4micm16RosenbrockSolverE" title="micm::RosenbrockSolver"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">micm::RosenbrockSolver</span></code></a>, we have to define a chemical system (<a class="reference internal" href="../api/index.html#_CPPv4N4micm6SystemE" title="micm::System"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">micm::System</span></code></a>)
and our reactions, which will be a vector of <a class="reference internal" href="../api/index.html#_CPPv4N4micm7ProcessE" title="micm::Process"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">micm::Process</span></code></a> We will use the species to define these as
well as a <a class="reference internal" href="../api/index.html#_CPPv4N4micm5PhaseE" title="micm::Phase"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">micm::Phase</span></code></a>.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="p">(</span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="p">(</span><span class="s">&quot;B&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="p">(</span><span class="s">&quot;C&quot;</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Phase</span><span class="w"> </span><span class="n">gas_phase</span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">micm</span><span class="o">::</span><span class="n">Species</span><span class="o">&gt;</span><span class="p">{</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p>With the species and gas phase, we can define all of our reactions</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="n">reactants</span><span class="p">({</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">products</span><span class="p">({</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">rate_constant</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">UserDefinedRateConstant</span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="n">label_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r1&quot;</span><span class="w"> </span><span class="p">}))</span>
<span class="w">                         </span><span class="p">.</span><span class="n">phase</span><span class="p">(</span><span class="n">gas_phase</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="n">reactants</span><span class="p">({</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">products</span><span class="p">({</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">rate_constant</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">UserDefinedRateConstant</span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="n">label_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r2&quot;</span><span class="w"> </span><span class="p">}))</span>
<span class="w">                         </span><span class="p">.</span><span class="n">phase</span><span class="p">(</span><span class="n">gas_phase</span><span class="p">);</span>

<span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="w">                         </span><span class="p">.</span><span class="n">reactants</span><span class="p">({</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">products</span><span class="p">({</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">yields</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="p">})</span>
<span class="w">                         </span><span class="p">.</span><span class="n">rate_constant</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">UserDefinedRateConstant</span><span class="p">({</span><span class="w"> </span><span class="p">.</span><span class="n">label_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;r3&quot;</span><span class="w"> </span><span class="p">}))</span>
<span class="w">                         </span><span class="p">.</span><span class="n">phase</span><span class="p">(</span><span class="n">gas_phase</span><span class="p">);</span>
</pre></div>
</div>
<p>Now we can define our RosenbrockSolver. This time we’ll form the reactions and chemical system in place.
Also, notice the <code class="docutils literal notranslate"><span class="pre">false</span></code> in our <a class="reference internal" href="../api/index.html#_CPPv4N4micm26RosenbrockSolverParametersE" title="micm::RosenbrockSolverParameters"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">micm::RosenbrockSolverParameters</span></code></a>. This tells the solver
not to reorder the state variables. The reordering is an optimization that can minizie fill-in for some
of the linear algebra operations. For this example, it’s turned off so that the order of the state matches
the order the species are added to the gas phase.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="n">micm</span><span class="o">::</span><span class="n">RosenbrockSolver</span><span class="o">&lt;&gt;</span><span class="w"> </span><span class="n">solver</span><span class="p">{</span><span class="w"> </span><span class="n">micm</span><span class="o">::</span><span class="n">System</span><span class="p">(</span><span class="n">micm</span><span class="o">::</span><span class="n">SystemParameters</span><span class="p">{</span><span class="w"> </span><span class="p">.</span><span class="n">gas_phase_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gas_phase</span><span class="w"> </span><span class="p">}),</span>
<span class="w">                                   </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">micm</span><span class="o">::</span><span class="n">Process</span><span class="o">&gt;</span><span class="p">{</span><span class="w"> </span><span class="n">r1</span><span class="p">,</span><span class="w"> </span><span class="n">r2</span><span class="p">,</span><span class="w"> </span><span class="n">r3</span><span class="w"> </span><span class="p">},</span>
<span class="w">                                   </span><span class="n">micm</span><span class="o">::</span><span class="n">RosenbrockSolverParameters</span><span class="o">::</span><span class="n">three_stage_rosenbrock_parameters</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">};</span>
</pre></div>
</div>
<p>Now we need to get a state and set the concentations of each of the species. In the
“<a class="reference internal" href="rate_constant_tutorial.html#rate-constants-set-concentations"><span class="std std-ref">Initializing the state</span></a>” section of the rate constants tutorial,
we used a <code class="docutils literal notranslate"><span class="pre">std::unordered_map&lt;std::string,</span> <span class="pre">std::vector&lt;double&gt;&gt;</span></code>
to set the concentrations. Here we will set the concentations by providing the <a class="reference internal" href="../api/index.html#_CPPv4N4micm7SpeciesE" title="micm::Species"><code class="xref cpp cpp-class docutils literal notranslate"><span class="pre">micm::Species</span></code></a> objects.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">GetState</span><span class="p">();</span>

<span class="w">  </span><span class="c1">// mol m-3</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetConcentration</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">{</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="p">});</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetConcentration</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetConcentration</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
</pre></div>
</div>
<p>Then we set the reaction rates by creating a vector that is 3 elements long, one for each grid cell.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">k1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.04</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">k2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3e7</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">k3</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e4</span><span class="p">;</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetCustomRateParameter</span><span class="p">(</span><span class="s">&quot;r1&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">k1</span><span class="p">));</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetCustomRateParameter</span><span class="p">(</span><span class="s">&quot;r2&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">k2</span><span class="p">));</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">SetCustomRateParameter</span><span class="p">(</span><span class="s">&quot;r3&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="n">k3</span><span class="p">));</span>
</pre></div>
</div>
<p>And lastly set the temperature, pressure, and air density for each grid cell.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">temperature</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">272.5</span><span class="p">;</span><span class="w">  </span><span class="c1">// [K]</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">pressure</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">101253.3</span><span class="p">;</span><span class="w">  </span><span class="c1">// [Pa]</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">air_density</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e6</span><span class="p">;</span><span class="w">    </span><span class="c1">// [mol m-3]</span>

<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">cell</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">parameters_</span><span class="p">.</span><span class="n">number_of_grid_cells_</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">cell</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">conditions_</span><span class="p">[</span><span class="n">cell</span><span class="p">].</span><span class="n">temperature_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">temperature</span><span class="p">;</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">conditions_</span><span class="p">[</span><span class="n">cell</span><span class="p">].</span><span class="n">pressure_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pressure</span><span class="p">;</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">conditions_</span><span class="p">[</span><span class="n">cell</span><span class="p">].</span><span class="n">air_density_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">air_density</span><span class="p">;</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>Now we are ready to run the simulation.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c1">// choose a timestep and print the initial state</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">time_step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">200</span><span class="p">;</span><span class="w">  </span><span class="c1">// s</span>

<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">PrintHeader</span><span class="p">();</span>
<span class="w">  </span><span class="n">state</span><span class="p">.</span><span class="n">PrintState</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="w">  </span><span class="c1">// solve for ten iterations</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="w">  </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// Depending on how stiff the system is</span>
<span class="w">    </span><span class="c1">// the solver integration step may not be able to solve for the full time step</span>
<span class="w">    </span><span class="c1">// so we need to track how much time the solver was able to integrate for and continue</span>
<span class="w">    </span><span class="c1">// solving until we finish</span>
<span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">elapsed_solve_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>

<span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">elapsed_solve_time</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">time_step</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">Solve</span><span class="p">(</span><span class="n">time_step</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">elapsed_solve_time</span><span class="p">,</span><span class="w"> </span><span class="n">state</span><span class="p">);</span>
<span class="w">      </span><span class="n">elapsed_solve_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">final_time_</span><span class="p">;</span>
<span class="w">      </span><span class="n">state</span><span class="p">.</span><span class="n">variables_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">result_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">state</span><span class="p">.</span><span class="n">PrintState</span><span class="p">(</span><span class="n">time_step</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<span class="w">  </span><span class="p">}</span>
</pre></div>
</div>
<p>And these are the results.</p>
<table class="table">
<colgroup>
<col style="width: 14.3%" />
<col style="width: 14.3%" />
<col style="width: 23.8%" />
<col style="width: 23.8%" />
<col style="width: 23.8%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>time</p></th>
<th class="head"><p>grid</p></th>
<th class="head"><p>A</p></th>
<th class="head"><p>B</p></th>
<th class="head"><p>C</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>0</p></td>
<td><p>0</p></td>
<td><p>1.00e+00</p></td>
<td><p>0.00e+00</p></td>
<td><p>0.00e+00</p></td>
</tr>
<tr class="row-odd"><td><p>0</p></td>
<td><p>1</p></td>
<td><p>2.00e+00</p></td>
<td><p>0.00e+00</p></td>
<td><p>0.00e+00</p></td>
</tr>
<tr class="row-even"><td><p>0</p></td>
<td><p>2</p></td>
<td><p>5.00e-01</p></td>
<td><p>0.00e+00</p></td>
<td><p>0.00e+00</p></td>
</tr>
<tr class="row-odd"><td><p>200</p></td>
<td><p>0</p></td>
<td><p>5.35e-01</p></td>
<td><p>4.49e-06</p></td>
<td><p>4.65e-01</p></td>
</tr>
<tr class="row-even"><td><p>200</p></td>
<td><p>1</p></td>
<td><p>1.21e+00</p></td>
<td><p>6.01e-06</p></td>
<td><p>7.89e-01</p></td>
</tr>
<tr class="row-odd"><td><p>200</p></td>
<td><p>2</p></td>
<td><p>2.30e-01</p></td>
<td><p>3.31e-06</p></td>
<td><p>2.70e-01</p></td>
</tr>
<tr class="row-even"><td><p>400</p></td>
<td><p>0</p></td>
<td><p>4.50e-01</p></td>
<td><p>3.23e-06</p></td>
<td><p>5.50e-01</p></td>
</tr>
<tr class="row-odd"><td><p>400</p></td>
<td><p>1</p></td>
<td><p>1.05e+00</p></td>
<td><p>4.42e-06</p></td>
<td><p>9.45e-01</p></td>
</tr>
<tr class="row-even"><td><p>400</p></td>
<td><p>2</p></td>
<td><p>1.85e-01</p></td>
<td><p>2.32e-06</p></td>
<td><p>3.15e-01</p></td>
</tr>
<tr class="row-odd"><td><p>600</p></td>
<td><p>0</p></td>
<td><p>4.00e-01</p></td>
<td><p>2.63e-06</p></td>
<td><p>6.00e-01</p></td>
</tr>
<tr class="row-even"><td><p>600</p></td>
<td><p>1</p></td>
<td><p>9.59e-01</p></td>
<td><p>3.65e-06</p></td>
<td><p>1.04e+00</p></td>
</tr>
<tr class="row-odd"><td><p>600</p></td>
<td><p>2</p></td>
<td><p>1.60e-01</p></td>
<td><p>1.85e-06</p></td>
<td><p>3.40e-01</p></td>
</tr>
<tr class="row-even"><td><p>800</p></td>
<td><p>0</p></td>
<td><p>3.64e-01</p></td>
<td><p>2.27e-06</p></td>
<td><p>6.36e-01</p></td>
</tr>
<tr class="row-odd"><td><p>800</p></td>
<td><p>1</p></td>
<td><p>8.90e-01</p></td>
<td><p>3.18e-06</p></td>
<td><p>1.11e+00</p></td>
</tr>
<tr class="row-even"><td><p>800</p></td>
<td><p>2</p></td>
<td><p>1.42e-01</p></td>
<td><p>1.57e-06</p></td>
<td><p>3.58e-01</p></td>
</tr>
<tr class="row-odd"><td><p>1000</p></td>
<td><p>0</p></td>
<td><p>3.37e-01</p></td>
<td><p>2.01e-06</p></td>
<td><p>6.63e-01</p></td>
</tr>
<tr class="row-even"><td><p>1000</p></td>
<td><p>1</p></td>
<td><p>8.35e-01</p></td>
<td><p>2.85e-06</p></td>
<td><p>1.16e+00</p></td>
</tr>
<tr class="row-odd"><td><p>1000</p></td>
<td><p>2</p></td>
<td><p>1.29e-01</p></td>
<td><p>1.38e-06</p></td>
<td><p>3.71e-01</p></td>
</tr>
<tr class="row-even"><td><p>1200</p></td>
<td><p>0</p></td>
<td><p>3.15e-01</p></td>
<td><p>1.82e-06</p></td>
<td><p>6.85e-01</p></td>
</tr>
<tr class="row-odd"><td><p>1200</p></td>
<td><p>1</p></td>
<td><p>7.91e-01</p></td>
<td><p>2.60e-06</p></td>
<td><p>1.21e+00</p></td>
</tr>
<tr class="row-even"><td><p>1200</p></td>
<td><p>2</p></td>
<td><p>1.19e-01</p></td>
<td><p>1.24e-06</p></td>
<td><p>3.81e-01</p></td>
</tr>
<tr class="row-odd"><td><p>1400</p></td>
<td><p>0</p></td>
<td><p>2.96e-01</p></td>
<td><p>1.67e-06</p></td>
<td><p>7.04e-01</p></td>
</tr>
<tr class="row-even"><td><p>1400</p></td>
<td><p>1</p></td>
<td><p>7.54e-01</p></td>
<td><p>2.40e-06</p></td>
<td><p>1.25e+00</p></td>
</tr>
<tr class="row-odd"><td><p>1400</p></td>
<td><p>2</p></td>
<td><p>1.11e-01</p></td>
<td><p>1.13e-06</p></td>
<td><p>3.89e-01</p></td>
</tr>
<tr class="row-even"><td><p>1600</p></td>
<td><p>0</p></td>
<td><p>2.81e-01</p></td>
<td><p>1.55e-06</p></td>
<td><p>7.19e-01</p></td>
</tr>
<tr class="row-odd"><td><p>1600</p></td>
<td><p>1</p></td>
<td><p>7.21e-01</p></td>
<td><p>2.24e-06</p></td>
<td><p>1.28e+00</p></td>
</tr>
<tr class="row-even"><td><p>1600</p></td>
<td><p>2</p></td>
<td><p>1.04e-01</p></td>
<td><p>1.04e-06</p></td>
<td><p>3.96e-01</p></td>
</tr>
<tr class="row-odd"><td><p>1800</p></td>
<td><p>0</p></td>
<td><p>2.67e-01</p></td>
<td><p>1.45e-06</p></td>
<td><p>7.33e-01</p></td>
</tr>
<tr class="row-even"><td><p>1800</p></td>
<td><p>1</p></td>
<td><p>6.93e-01</p></td>
<td><p>2.11e-06</p></td>
<td><p>1.31e+00</p></td>
</tr>
<tr class="row-odd"><td><p>1800</p></td>
<td><p>2</p></td>
<td><p>9.77e-02</p></td>
<td><p>9.65e-07</p></td>
<td><p>4.02e-01</p></td>
</tr>
<tr class="row-even"><td><p>2000</p></td>
<td><p>0</p></td>
<td><p>2.55e-01</p></td>
<td><p>1.37e-06</p></td>
<td><p>7.45e-01</p></td>
</tr>
<tr class="row-odd"><td><p>2000</p></td>
<td><p>1</p></td>
<td><p>6.68e-01</p></td>
<td><p>2.00e-06</p></td>
<td><p>1.33e+00</p></td>
</tr>
<tr class="row-even"><td><p>2000</p></td>
<td><p>2</p></td>
<td><p>9.25e-02</p></td>
<td><p>9.02e-07</p></td>
<td><p>4.07e-01</p></td>
</tr>
</tbody>
</table>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="user_defined_rate_constant_tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">User-Defined Rate Constants</p>
      </div>
    </a>
    <a class="right-next"
       href="solver_configurations.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Solver configurations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#line-by-line-explanation">Line-by-line explanation</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/user_guide/multiple_grid_cells.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2022-2024, NCAR/UCAR.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>